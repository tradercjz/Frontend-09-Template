## 学习笔记



## CSS计算

### 1. 收集CSS规则


### 2. 添加调用
* 当我们创建一个元素后,立即计算CSS
* 理论上,当我们分析一个元素时,所有的CSS规则已经收集完毕
* 在真实的浏览器中,可能遇到body的style标签,需要重新CSS计算的情况,这里我们忽略 

### 3.获取父元素序列
原因:今天的选择器大多数是跟父元素相关的

* 在computeCSS函数中,我们必须知道元素所有的父元素才能判断元素与规则是否匹配
* 从上一步骤的stack,可以获取本元素所有的父元素 
* 因为我们首先好获取的是“当前元素“,所以我们获得和计算父元素匹配的顺序是从内向外

> "div div #myid" 前面两个div不知道匹配哪个元素,但是 myid一定匹配当前元素



### 4. 选择器与元素的匹配

>参考[CSS选择器](https://time.geekbang.org/column/article/84365)

* 选择器也要从当前元素向外排列
* 复杂选择器拆成针对单个元素的选择器,用循环匹配父元素队列


###  5. 计算选择器与元素匹配

*  根据选择器的类型和元素属性,计算是否与当前元素匹配
*  这里仅仅实现了三种基本选择器,实际浏览器要处理复合选择器


### 6. 生成computed属性

* 一旦选择器匹配上,就应用选择器到元素上,形成computedStyle

### 7. specificity的计算逻辑

* CSS规则根据specificity和后来优先规则覆盖
* specificity是个四元组,越左边权重越高
* 一个CSS规则的specificity根据包含的简单选择器相加而成

specificity:
[`inline, `id, `class, `tag]



